# Time Tracker tmux hook configuration
#
# Records pane focus events for time tracking. Four hooks cover all
# navigation paths; the 500ms debounce in tt deduplicates overlapping fires.
#
# Installation:
#   1. Ensure `tt` is in your PATH
#   2. Add to ~/.tmux.conf: source-file /path/to/config/tmux-hook.conf
#   3. Reload tmux: tmux source-file ~/.tmux.conf
#   4. IMPORTANT: Detach and reattach for focus-events to take effect
#
# Verify it's working:
#   - Switch between panes/windows/sessions
#   - Check ~/.local/share/tt/events.jsonl for new events
#   - Check ~/.local/state/tt/hook.log for errors

# Enable focus events (required for pane-focus-in hook)
set -g focus-events on

# Record pane focus changes for time tracking.
# - -ga appends to not clobber other hooks on the same event
# - -b runs in background (non-blocking, prevents pane switch lag)
# - stderr goes to hook.log for debuggability

# Terminal regains OS-level focus (e.g. alt-tab back to terminal)
set-hook -ga pane-focus-in 'run-shell -b "mkdir -p $HOME/.local/state/tt && tt ingest pane-focus --pane \"#{pane_id}\" --cwd \"#{pane_current_path}\" --session \"#{session_name}\" --window \"#{window_index}\" 2>>$HOME/.local/state/tt/hook.log"'
# Switch panes within a window (e.g. Ctrl-b arrow)
set-hook -ga after-select-pane 'run-shell -b "mkdir -p $HOME/.local/state/tt && tt ingest pane-focus --pane \"#{pane_id}\" --cwd \"#{pane_current_path}\" --session \"#{session_name}\" --window \"#{window_index}\" 2>>$HOME/.local/state/tt/hook.log"'
# Switch windows within a session
set-hook -ga session-window-changed 'run-shell -b "mkdir -p $HOME/.local/state/tt && tt ingest pane-focus --pane \"#{pane_id}\" --cwd \"#{pane_current_path}\" --session \"#{session_name}\" --window \"#{window_index}\" 2>>$HOME/.local/state/tt/hook.log"'
# Switch between tmux sessions
set-hook -ga client-session-changed 'run-shell -b "mkdir -p $HOME/.local/state/tt && tt ingest pane-focus --pane \"#{pane_id}\" --cwd \"#{pane_current_path}\" --session \"#{session_name}\" --window \"#{window_index}\" 2>>$HOME/.local/state/tt/hook.log"'
